# Название задачи:

MVP «Платформа мониторинга скота» — критерии выбора решения: **Edge-first** vs **Cloud-first**

# Автор:

Минлигареев Максим Александрович

# Дата:

02.11.2025

---

## Контекст

Есть два финальных варианта решения:

- **Edge-first (основное):** инференс и первичная обработка на фермах (Агент + Model Runner, локальный MQTT), центр — Core, Kafka, Media/Config, S3, Postgres/TSDB.
- **Cloud-first (альтернативное):** «тонкий» агент на ферме; видео → Stream Gateway → Realtime Inference (GPU) → Event Bus; датчики и актуаторы — через центральный IoT Core (MQTT).

Необходимо сравнить решения по согласованным критериям и дать рекомендацию

---

## Критерии и веса

Вес отражает значимость для MVP при масштабировании.

|  №  | Критерий                             | Что оцениваем                                 |  Вес |
| :-: | ------------------------------------ | --------------------------------------------- | ---: |
|  1  | Задержка от события до оповещения    | P95, цель ≤ 5 c                               | 0.15 |
|  2  | Устойчивость к офлайн-режиму ферм    | Полезная работа без связи, синхронизация      | 0.15 |
|  3  | Сетевые издержки/осуществимость      | Трафик видео/клипов, требования к uplink      | 0.10 |
|  4  | Централизация MLOps/контроль моделей | Единый реестр/мониторинг/деплой               | 0.10 |
|  5  | Эксплуатационная сложность           | Сложность поддержки на фермах/в центре        | 0.10 |
|  6  | Масштабирование при росте ферм/камер | Линейное масштабирование вычислений/шины      | 0.10 |
|  7  | Приватность/локализация видео        | Вынос данных за ферму, соответствие политикам | 0.08 |
|  8  | Time-to-Market                       | Скорость запуска MVP                          | 0.07 |
|  9  | TCO (12 мес.)                        | CapEx на edge vs OpEx GPU/сеть                | 0.08 |
| 10  | Риски                                | Зависимость от сети vs управление парком edge | 0.07 |

Оценки: 1 — плохо, 3 — приемлемо, 5 — отлично.

---

## Оценка вариантов (балл × вес)

| Критерий                  |           Edge-first |          Cloud-first |
| ------------------------- | -------------------: | -------------------: |
| 1. Задержка до оповещения |    5×0.15 = **0.75** | 3.5×0.15 = **0.525** |
| 2. Офлайн-устойчивость    |    5×0.15 = **0.75** |    2×0.15 = **0.30** |
| 3. Сетевые издержки       |  4.5×0.10 = **0.45** |    3×0.10 = **0.30** |
| 4. Централизация MLOps    |    3×0.10 = **0.30** |    5×0.10 = **0.50** |
| 5. Эксплуатация           |    3×0.10 = **0.30** |    4×0.10 = **0.40** |
| 6. Масштабирование        |    4×0.10 = **0.40** |    4×0.10 = **0.40** |
| 7. Приватность видео      |    5×0.08 = **0.40** |    3×0.08 = **0.24** |
| 8. Time-to-Market         | 3.5×0.07 = **0.245** | 3.5×0.07 = **0.245** |
| 9. TCO (12 мес.)          |  3.5×0.08 = **0.28** |  3.5×0.08 = **0.28** |
| 10. Риски                 | 3.5×0.07 = **0.245** |    3×0.07 = **0.21** |
| **Итог**                  |             **4.12** |             **3.40** |

---

## Анализ по критериям

### Edge-first

**Сильные стороны**

- **Минимальная и стабильная задержка** (мс на ферме) и **реальная офлайн-работа** — соответствуют ключевым NFR и условиям нестабильной связи.
- **Меньше видеотрафика** в центр: отправляем события и клипы по триггерам, не постоянный live-стрим.
- **Приватность**: сырое видео остаётся локально; в центр летят артефакты и метаданные.

**Слабые стороны**

- «Толстый» edge: железо, OTA-выкаты моделей/плагинов, мониторинг агентов.
- Сложнее DevOps на шине событий и хранениях при росте.

### Cloud-first

**Сильные стороны**

- **Единый MLOps**: версии, мониторинг, логирование и отладка моделей в одном месте (GPU-кластер).
- **Проще edge**: меньше разнородности и версиирования в полях.

**Слабые стороны**

- **Сетезависимость** и переменная задержка; офлайн-сценарии ограничены (только простые локальные эвристики).
- **Сетевые/облачные затраты** из-за постоянного видеопотока.

---

## Рекомендация

Выбрать **Edge-first** как целевую архитектуру MVP и ближайшего масштаба: она выигрывает по суммарному баллу и ключевым для бизнеса критериям (латентность, офлайн, приватность).  
**Cloud-first** сохранить как стратегическую альтернативу, когда:

- uplink-каналы стабильны и недороги,
- важнее централизованный MLOps и быстрый оборот моделей,
- есть ограничения на вычисления/поддержку на фермах.

---

## План снижения рисков и «мягкой» миграции

- **Edge-first → Cloud-first (при необходимости):** добавить Stream Gateway, включить «dual write» (параллельный поток видео в центр), держать центральный инференс в shadow-режиме, затем переводить правила на результаты из центра.
- **Cloud-first → Edge-first:** выкатывать модели из Registry на фермы (OTA), включать локальные пайплайны; оставить центральный инференс для валидации качества.

---

## Краткое резюме для бизнеса

- При сегодняшних вводных (нестабильная связь, требование реакции ≤ 5 с) — **Edge-first**.
- **Cloud-first** — опция роста и унификации MLOps, но требует устойчивых сетей и бюджета на видеотрафик/GPU.
