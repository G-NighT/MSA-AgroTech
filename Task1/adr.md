# Название задачи:

Архитектура MVP «Платформа мониторинга скота» — сравнение двух подходов на уровне C1 (контекст):  
A) **Edge-first** (инференс на фермах) — основное решение  
B) **Cloud-first** (центральный инференс, «тонкий» edge) — альтернативное решение

# Автор:

Минлигареев Максим Александрович

# Дата:

02.11.2025

---

## Функциональные требования

|  №  | Действующие лица или системы | Use Case                                              | Описание (шаги)                                                                                                                                                                                 |
| :-: | :--------------------------- | :---------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|  1  | Оператор фермы               | Получить и подтвердить инцидент                       | 1) Камера/инференс фиксируют событие → 2) Core создаёт инцидент и отправляет оповещение → 3) Оператор открывает карточку, смотрит клип/кадр → 4) Подтверждает/отклоняет, добавляет комментарий. |
|  2  | Ветврач/Зоотехник            | Проанализировать состояние животных                   | 1) Входит в портал → 2) Смотрит ленту событий/клипы и метрики → 3) Формирует рекомендации/задачи.                                                                                               |
|  3  | Директор хозяйства           | Посмотреть KPI/сводку                                 | 1) BI читает витрины и артефакты (pre-signed URL) → 2) Руководитель смотрит дашборды KPI.                                                                                                       |
|  4  | Датчики/Актуаторы            | Передать телеметрию / получить команды                | 1) Передают телеметрию (MQTT) → 2) Core отправляет команды (MQTT) при инцидентах/правилах.                                                                                                      |
|  5  | Мобильное приложение         | Получить пуш-уведомление и быстрый доступ к инциденту | 1) Core формирует уведомление → 2) Пользователь открывает карточку инцидента, принимает действие.                                                                                               |
|  6  | Система                      | Управление моделями инференса                         | A) Edge-first: Registry доставляет модели на фермы (OTA). B) Cloud-first: Registry выкатывает модели в центральный GPU-кластер.                                                                 |
|  7  | ERP/ВИ-система               | Интеграции                                            | 1) Core отдает события/справочники в ERP/ВИ → 2) BI/ERP используют данные для отчетности/планирования.                                                                                          |

---

## Нефункциональные требования

|  №  | Требование                                                                               |
| :-: | :--------------------------------------------------------------------------------------- |
|  1  | Доступность платформы около 99,95%.                                                      |
|  2  | Время от фиксации события до оповещения — не более 5 секунд (P95).                       |
|  3  | Инференс должен реагировать в реальном времени (миллисекунды) — критично для Edge-first. |
|  4  | Масштабируемость по числу ферм/камер/датчиков; возможность добавлять метрики.            |
|  5  | Работа при отсутствии интернета на ферме с последующей синхронизацией.                   |
|  6  | Современный IAM/SSO и разграничение ролей (RBAC).                                        |
|  7  | Экономичное хранение медиа (клипы/кадры) и безопасная раздача (pre-signed ссылки).       |
|  8  | Наблюдаемость: метрики/логи/трейсы, DLQ/реплей в выбранной шине/шлюзе событий.           |

---

## Решение

### Контекстные диаграммы (C1)

- **C1-main (Edge-first):**  
  На фермах установлены **Агент фермы** и **Model Runner** (инференс локально). Локальный MQTT обслуживает устройства. Агент публикует события и телеметрию в центральную шину (Kafka), по событию грузит клипы/кадры в объектное хранилище (S3). **Core: Платформа мониторинга** обрабатывает события, отправляет уведомления, управляет устройствами и интегрируется с ERP/BI. **Model Registry & Policy** выполняет OTA-выкаты моделей на фермы.
- **C1-alt (Cloud-first):**  
  На фермах «тонкий» агент выполняет захват/ингест видео и буферизацию. Видео поступает в **Stream Gateway**, далее в **Realtime Inference (GPU)** в центре; результаты публикуются во внутренний **Event Bus** и обрабатываются **Core**. Датчики обращаются к **IoT Core (MQTT)** централизованно. **Registry** выкатывает модели в GPU-кластер.

### Логика выбора

- **Edge-first** минимизирует сеть и обеспечивает офлайн-устойчивость/минимальную задержку (мс), что напрямую соответствует требованию «реагировать в реальном времени» и слабому каналу на фермах.
- **Cloud-first** упрощает ферму (нет GPU/плагинов), даёт единый MLOps и централизованный контроль моделей, но чувствителен к uplink-каналу и повышает сетевые издержки.

---

## Альтернативы

1. **Edge-first (основное).** Инференс и первичная аналитика на фермах; центр — координация/инциденты/хранилища/интеграции.
2. **Cloud-first (альтернативное).** Инференс в центре на GPU; edge — шлюз/буфер, телеметрия в центральный MQTT.

---

## Недостатки, ограничения, риски

**Edge-first**

- Управление версиями и безопасностью на большом числе ферм (OTA, наблюдаемость).
- Требования к «толстому» edge-железу.
- Операционная сложность центральной шины событий по мере роста.

**Cloud-first**

- Зависимость от стабильного uplink-канала для live-видео; риск роста задержек.
- Хуже офлайн-поведение (компенсируем простыми эвристиками на ферме).
- Сетевые/облачные затраты на транспорт видео и GPU-ёмкость.

**Общее для обоих**

- Ложные срабатывания моделей (ночь/тени) — требуется настройка порогов/ROI, обратная связь оператора, итеративное улучшение моделей.
- Стоимость хранения медиа — нужны политики TTL/жизненного цикла и хранение только «событийных» клипов.

---

## Вывод

Оба подхода валидны в контексте MVP. Для начального ввода на нестабильных фермах и жёсткого требования к задержке **рекомендуем Edge-first**. **Cloud-first** фиксируем как стратегическую альтернативу при приоритете единого GPU-стека и упрощённого edge; выбор зависит от каналов связи и операционных ограничений.
